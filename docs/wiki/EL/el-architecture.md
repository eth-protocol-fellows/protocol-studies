# Overview 

Beyond its fundamental role of transaction execution , the Execution Layer client undertakes several critical responsibilities. These include synchronizing its blockchain copy, facilitating network communication through gossip protocols with other Execution Layer clients, minting a transaction pool, and fulfilling the Consensus Layer's requirements that drive its functionality. This multifaceted operation ensures the robustness and integrity of the Ethereum network.

The client's architecture is grounded in a series of detailed specifications, each playing a unique role in its comprehensive functionality. This document aims to provide a concise overview of the core specification. For a deeper understanding of how all the specifications seamlessly work together within the Execution Layer Client.

# Engine  

The Execution-Layer's Engine that exposes the Engine API to the consensus layer allows for running multiple instances of the execution layer but accepts only one instance of consensus layer , furthermore the engine API uses the JSON-RPC interface over multiple transports , of which HTTP and Websockets are authenticated via a [JWT](https://jwt.io/introduction) token and for ipc communication no authentication is required . Additionally the engine JSON-RPC is not exposed to anyone besides the consensus layer. However its important to note that the JWT is primarily used for authenticating the Payload , i.e. the sender is the consensus layer , it does not necessarily encrypt such traffic , thus its possible for network sniffers to observe these exchanges or attackers to perform [replay-attacks](https://en.wikipedia.org/wiki/Replay_attack)

## ForkChoice Updated

## NewPayload Updated

# Boot nodes Network Bootup

# Downloader

# EL's BlockChain

## Consensus Engines in EL

The execution Layer has its own consensus engine to work with its own copy of the beacon chain . The EL consensus engine is known as ethOne and has about half the functionality of the full fledged consensus engine of the CL.
The Algorithm agnostic interface of the consensus engine in EL has these functions

| Function                                                                                                                | Beacon (Proof Of Stake)                                                                                                                                                                               | Clique (Proof Of Authority)                                                                                                                                                                                                                                                                                                                                                                                                                             | Ethash (Proof Of Work) |
| ----------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| **Author** : Eth address of the Block minter                                                                            | If the Header is a POS header(header difficulty is set to 0) then we return Header.coinbase else we send the header for processing to the beacon's eth one engine (clique or ethash) | Retrieves the account address the minted the block. In Clique , this done by Ecrerecover that revovers the publik key from the Header's ExtraData                                                                                                                                                                                                                                                                                  |        |
| **Verify Header(s)** : Takes a batch of headers and verifies them based on the rules of the current consensus engine. : |                                                                                                                                                                                                            Split the headers based on [Terminal Total difficulty](https://eips.ethereum.org/EIPS/eip-3675#definitions) into Pre and Post TTD batches . Verify the pre batches with the ethone engine and the post by beacon's verify header                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                    |        |
|                                                                                                                         | Here we perform block header verification simmilar to the one in the [EL-Specs](wiki/EL/el-specs?id=block-header-validation) wiki page                                               | We verify the time of the header is not greater than system time.                                                                                                                                                                                                                                                                                                                                                                  |        |
|                                                                                                                         |                                                                                                                                                                                      | If it is a checkpoint(1'st slot of epoch) block then ensure has no benificiery.                                                                                                                                                                                                                                                                                                                                                    |        |
|                                                                                                                         |                                                                                                                                                                                      | The header nonce can be either 0x00..0(represents vote to add signer) or 0xff..f(represents vote to drop signer ), At checkpoints we can only drop the signer.                                                                                                                                                                                                                                                                     |        |
|                                                                                                                         |                                                                                                                                                                                      | The extradata length mush account for vanity + the signature. At Checkpoints , the extradata contains the signer List + Signature.                                                                                                                                                                                                                                                                                                 |        |
|                                                                                                                         |                                                                                                                                                                                      | Header gas checks.                                                                                                                                                                                                                                                                                                                                                                                                                 |        |
|                                                                                                                         |                                                                                                                                                                                      | Retrieve the snapshot ( config : Config for Consensus engine , signatureLRUCache : Cache speed up ecrecover, SnapshotBlockNumber, SnapshotBlockHash, Signers: authorized signers at this point , RecentSigners: used for spam protections, Votes : Chronologically ordered votes that were cast, VoteTally )                                                                                                                       |        |
|                                                                                                                         |                                                                                                                                                                                      | On checkpoint blocks verify the signers in the snapshot against the extradata                                                                                                                                                                                                                                                                                                                                                      |        |
|                                                                                                                         |                                                                                                                                                                                      | Verify Seal : Verifies if all the requirements are met for the signature contained in the header. THis is recovered using the header and the recent signers in the Clique object and then we check the the signer is included in the snapshot.signers obtained in step 6.                                                                                                                                                          |        |     |
| **Verify Uncles**                                                                                                       | If the Header is a POS header verify the length of uncles is 0 . If not POS , ethOne's verify uncles is called                                                                       | In Clique non uncles should be present                                                                                                                                                                                                                                                                                                                                                                                             |        |
| **Prepare** : Initialises the consensus fields of a block's header.                                                                                                            | If TTD is reached  we set the header's difficulty to beacon's difficulty(0) , else we call ethOne's prepare  | Assemble the voting snapshot by providing the parent hash and number: we iterate backwards from the block number : If we reach Genesis or if using a light client(doesn't store parent blocks) or if we reach an epoch by traversing or if the headers traversed are greater than the value for soft Finality(segment is considered immuatable) we create a snapshot at the checkpoint we have arrived at during reverse iteration |        |
|                                                                                                                         |                                                                                                                                                                                      | If we are not at the end of an epoch we iterate over the addresses in snap.proposals and randomly selecting one as the Coinbase and voting Authvote if the proposal is authorised else ve cast a drop vote.                                                                                                                                                                                                                        |        |
|                                                                                                                         |                                                                                                                                                                                      | Set the header difficulty based on signer's turn (2 if the signer is in turn and 1 if not)                                                                                                                                                                                                                                                                                                                                         |        |
|                                                                                         |                                | Ensure the extradata has all the required components such as extraVanity , list of signers if the block is at the end of the epoch . We add this to the Header.extraData.            |                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Finalize** : Post state modifications , state db might get updated does not assemble the block|  If not a PoS header we call ethOne's finalise  else we we iterate over the block's withdrawls , converting their amounts from wei to gwei and then making a state modification that adds the amount to the address in the current withdrawl                                                                                                                                                                                    | Clique has no post-transaction consensus rules , No Block Rewards in proof od authority                                                                                                                                                                                                                                                                                                                                            |        |
| **FinalizeAndAssemble**  : Finalises and assemble's the final block                                                                                               |   If not a PoS header we call ethOne's FinalizeAndAssemble, If withdrawals are nill and the block is after the shanghai fork , we add the an empty withdrawals object. Then we call finalise , compute the state root and assign it to header's root and build a new block block with the header. transactions, uncles, reciepts and withdrawals                                                                                                                                                                                    | Ensure no witdrawls are present , call Finalise,  compute the state root of our stateDB and assign it to Header's root and build a new block with the header , transactions and reciepts                                                                                                                                                                                                                                                                                                                                                                                                                                   |        |
| **Seal**  : Generates a sealing request for a block and pushes the request into the given chanel                                                                                                              |  If Not a PoS header we call ethOne's seal, else we do nothing and return nil (seal verification is done by the external consensus engine)                                                                                                                                                                                    |  Ensure its not the gensis block, retrieve the snapshot and verify that we are both authorised to sign and are not part of the recent signers, time synchronise our turn , sign with the  signFunction and propagate the sealed block on the given channel                                                                                                                                                                                                                                                                                                                                                                                                                                  |        |
| **SealHash** : Hash of the block prior to sealing                                                                                                           |                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                    |        |
| **CalcDifficulty** : Difficulty adjustment Algorithm, returns the difficulty of the new block                                                                                                     |                                                                                                                                                                                      |                                                                                                                                                                                                                                                                                                                                                                                                                                    |        |

# Sync

# Downloader

# Transaction pools

we have primarily two kinds of txPools :

1. legacy pools- this in geth contains price-sorted heaps / priority-queues
   where the transactions are sorted by price
   Two heaps are used for sorting: one is based on the effective tip in the next block) and the other based on gasFeeCap. On saturation the bigger of the two is chosen for eviction
2. blob pools - this also keeps a priority heap for eviction but there are a few things different about this, the code has an excelent comments section for these [blobPools](https://github.com/ethereum/go-ethereum/blob/064f37d6f67a012eea0bf8d410346fb1684004b4/core/txpool/blobpool/blobpool.go#L132) also note that logarithms are used in eviction queues in blob pools

In Ethereum two primary types of transaction pools (txPools) are recognized:

1. **Legacy Pools**: Managed by Geth, these pools employ price-sorted heaps or priority queues to organize transactions based on their price. Specifically, transactions are arranged using two heaps: one prioritizes the effective tip for the upcoming block, and the other focuses on the gas fee cap. During periods of saturation, the larger of these two heaps is selected for the eviction of transactions, optimizing the pool's efficiency and responsiveness. [urgent and floating heaps](https://github.com/ethereum/go-ethereum/blob/064f37d6f67a012eea0bf8d410346fb1684004b4/core/txpool/legacypool/list.go#L525)

2. **Blob Pools**: Unlike legacy pools, blob pools maintain a priority heap for transaction eviction but incorporate distinct mechanisms for operation. Notably, the implementation of blob pools is well-documented, with an extensive comments section available for review [here](https://github.com/ethereum/go-ethereum/blob/064f37d6f67a012eea0bf8d410346fb1684004b4/core/txpool/blobpool/blobpool.go#L132). A key feature of blob pools is the use of logarithmic functions in their eviction queues.
