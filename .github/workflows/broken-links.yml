name: Validate Markdown Links

on:
  push:
    paths:
      - "**/*.md"
      - ".github/workflows/broken-links.yml"
  pull_request:
    paths:
      - "**/*.md"
  workflow_dispatch:

jobs:
  check-links:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check markdown links
        id: check-links
        uses: lycheeverse/lychee-action@v2
        continue-on-error: true
        with:
          files: "**/*.md"
          retries: 3
          fail_on_error: false
          format: markdown
          output: /tmp/broken_links_report.txt

      - name: Log output
        if: steps.check-links.outcome == 'failure'
        run: |
          echo "### ðŸ”— Broken Links Report" >> $GITHUB_STEP_SUMMARY
          cat /tmp/broken_links_report.txt >> $GITHUB_STEP_SUMMARY
          exit 1
